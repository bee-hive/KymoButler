(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Wolfram 14.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       154,          7]
NotebookDataLength[     53262,       1267]
NotebookOptionsPosition[     49996,       1205]
NotebookOutlinePosition[     50417,       1222]
CellTagsIndexPosition[     50374,       1219]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"::", "Input", "::"}], "*)"}], 
  RowBox[{"(*", 
   RowBox[{"Load", " ", "necessary", " ", "KymoButler", " ", "packages"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Get", "[", 
    RowBox[{"FileNameJoin", "@", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"NotebookDirectory", "[", "]"}], ",", "\"\<packages\>\"", 
       ",", "\"\<KymoButler.wl\>\""}], "}"}]}], "]"}], "\n", 
   RowBox[{"Get", "[", 
    RowBox[{"FileNameJoin", "@", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"NotebookDirectory", "[", "]"}], ",", "\"\<packages\>\"", 
       ",", "\"\<KymoButlerPProc.wl\>\""}], "}"}]}], "]"}], "\n", 
   RowBox[{
    RowBox[{"models", "=", 
     RowBox[{"Quiet", "[", 
      RowBox[{"loadDefaultNets", "@", 
       RowBox[{"NotebookDirectory", "[", "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
    "Print", "[", "\"\<KymoButler packages loaded successfully.\>\"", "]"}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.974899967190836*^9, 3.974899967192569*^9}, {
   3.974900100104306*^9, 3.974900106140679*^9}, {3.974900229957614*^9, 
   3.9749002607195663`*^9}, {3.9749004110619926`*^9, 3.974900435687208*^9}, {
   3.9749005510243263`*^9, 3.974900566347649*^9}, 3.974903742820712*^9, {
   3.974903801578808*^9, 3.974903807087309*^9}, {3.974908731473633*^9, 
   3.97490875960736*^9}, {3.9749088669974337`*^9, 3.9749088784909563`*^9}, {
   3.975591107221922*^9, 3.975591139740571*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"4c09cc81-6789-4877-92cd-7752b83d4c52"],

Cell[BoxData["\<\"KymoButler packages loaded successfully.\"\>"], "Print",
 CellChangeTimes->{3.9755920668655376`*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"c8154190-4a69-4810-8d77-4cea139a3bcd"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\n", 
  RowBox[{"(*", " ", 
   RowBox[{"::", "Input", "::"}], " ", "*)"}], "\n", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Load", " ", "pre"}], "-", 
    RowBox[{
    "trained", " ", "models", " ", "on", " ", "master", " ", "kernel"}]}], 
   " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
    "Print", "[", "\"\<Loading pre-trained models on master kernel...\>\"", 
     "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"models", " ", "=", " ", 
     RowBox[{"loadDefaultNets", "[", 
      RowBox[{"NotebookDirectory", "[", "]"}], "]"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"models", " ", "===", " ", "$Failed"}], ",", " ", "\n", " ", 
      RowBox[{
       RowBox[{
       "Print", 
        "[", "\"\<Error: Failed to load models. Ensure the KymoButler package \
is correctly set up.\>\"", "]"}], ";", "\n", " ", 
       RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"Print", "[", "\"\<Models loaded successfully.\>\"", "]"}], ";"}],
    "\n", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"\"\<Available models: \>\"", ",", " ", 
      RowBox[{"Keys", "[", "models", "]"}]}], "]"}], ";"}]}]}]], "Code",
 CellChangeTimes->{{3.974900599246571*^9, 3.9749006223245296`*^9}, {
  3.9749011930250587`*^9, 3.974901195029667*^9}, {3.974901372220716*^9, 
  3.974901379685712*^9}, {3.9749143420489807`*^9, 3.974914343493741*^9}, {
  3.9749939335648623`*^9, 3.974994015708843*^9}, {3.974998280107476*^9, 
  3.97499828387927*^9}, {3.974998710493928*^9, 3.974998742979332*^9}, {
  3.975590911467074*^9, 3.975590925726932*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"102e89bc-f41f-4444-afd4-d1ee6d146d9b"],

Cell[BoxData["\<\"Loading pre-trained models on master kernel...\"\>"], \
"Print",
 CellChangeTimes->{3.975592115910383*^9},
 CellLabel->
  "During evaluation of \
In[5]:=",ExpressionUUID->"4b5f433b-1be4-4654-87ee-14a0df9716ba"],

Cell[BoxData[
 TemplateBox[{
  "CreateDirectory", "eexist", 
   "\"\\!\\(\\*RowBox[{\\\"\\\\\\\"/Users/aweiner/beehive/lab/adamw/\
KymoButler/models\\\\\\\"\\\"}]\\) already exists.\"", 2, 6, 1, 
   29392801815248834973, "Local"},
  "MessageTemplate",
  BaseStyle->"MSG"]], "Message",
 CellChangeTimes->{3.975592115960689*^9},
 CellLabel->
  "During evaluation of \
In[5]:=",ExpressionUUID->"114c7592-974b-4781-b78f-39d6279422f6"],

Cell[CellGroupData[{

Cell[BoxData["\<\"Models loaded successfully.\"\>"], "Print",
 CellChangeTimes->{3.9755921732144947`*^9},
 CellLabel->
  "During evaluation of \
In[5]:=",ExpressionUUID->"7974124d-ea4b-416d-8c1b-706e930abfd0"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Available models: \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"\<\"binet\"\>", ",", "\<\"classnet\"\>", ",", "\<\"uninet\"\>", 
     ",", "\<\"decnet\"\>"}], "}"}]}],
  SequenceForm[
  "Available models: ", {"binet", "classnet", "uninet", "decnet"}],
  Editable->False]], "Print",
 CellChangeTimes->{3.975592173216098*^9},
 CellLabel->
  "During evaluation of \
In[5]:=",ExpressionUUID->"5b5a4130-f239-47a8-b35d-807c72621981"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\n", 
  RowBox[{"(*", " ", 
   RowBox[{"::", "Input", "::"}], " ", "*)"}], "\n", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Manually", " ", "set", " ", "the", " ", "directory", " ", "path", " ", 
    "of", " ", "images"}], " ", "*)"}], "\n", "\n", 
  RowBox[{"(*", " ", 
   RowBox[{
   "===", "===", "===", "===", "===", "===", "===", "===", "===", "=="}], " ",
    "*)"}], "\n", 
  RowBox[{"(*", " ", 
   RowBox[{"User", " ", "parameters"}], "               ", "*)"}], "\n", 
  RowBox[{"(*", " ", 
   RowBox[{
   "===", "===", "===", "===", "===", "===", "===", "===", "===", "=="}], " ",
    "*)"}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "baseDir", " ", "=", 
     " ", "\"\</Users/aweiner/Documents/MFN2-project/kymobutler/processed_\
kymographs/250310_D10/processed_on_20251024/raw\>\""}], ";"}], "*)"}], "\n", 
  "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
    "baseDir", " ", "=", 
     " ", "\"\</Users/aweiner/beehive/lab/ConklinLabMFN2Data/processed_\
kymographs/250310_D10/processed_on_20251024\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{"inputDir", " ", "=", " ", 
     RowBox[{"FileNameJoin", "[", 
      RowBox[{"{", 
       RowBox[{"baseDir", ",", " ", "\"\<raw\>\""}], "}"}], "]"}]}], ";"}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{"wellIDs", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"\"\<B02\>\"", ",", " ", "\"\<B03\>\""}], "}"}]}], ";"}], "   ", 
   RowBox[{"(*", " ", 
    RowBox[{"<", 
     RowBox[{
      RowBox[{"--", " ", "edit"}], " ", "this", " ", "list"}]}], " ", "*)"}], 
   "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Minimum", " ", "kymograph", " ", "width", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"i", ".", "e", ".", " ", "axon"}], " ", "segment", " ", 
        "length"}], ")"}], " ", "to", " ", "consider", " ", "for", " ", 
      "downstream", " ", "analysis"}], ",", " ", 
     RowBox[{"units", " ", "are", " ", 
      RowBox[{"pixels", "."}]}]}], " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{"minLen", " ", "=", " ", "90"}], ";"}], "\n", "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "Experiment", " ", "parameters", " ", "describing", " ", "the", " ", 
      "spatial", " ", "and", " ", "temporal", " ", "resolution", " ", "of", " ",
       "the", " ", "time"}], "-", 
     RowBox[{"series", " ", "images"}]}], " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{"umPerPixel", " ", "=", " ", "0.684132"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"secPerFrame", " ", "=", " ", "2.0"}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"outputDir", " ", "=", " ", 
     RowBox[{"FileNameJoin", "[", 
      RowBox[{"{", 
       RowBox[{"baseDir", ",", " ", "\"\<kymobutler_outputs\>\""}], "}"}], 
      "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"!", 
       RowBox[{"DirectoryQ", "[", "outputDir", "]"}]}], ",", " ", 
      RowBox[{"CreateDirectory", "[", "outputDir", "]"}]}], "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"\"\<Output directory: \>\"", ",", " ", "outputDir"}], "]"}], 
    ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"getSelectedFilesForWell", "[", "well_", "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "dir", "}"}], ",", "\n", "  ", 
       RowBox[{
        RowBox[{"dir", " ", "=", " ", 
         RowBox[{"FileNameJoin", "[", 
          RowBox[{"{", 
           RowBox[{"inputDir", ",", " ", "well"}], "}"}], "]"}]}], ";", "\n", 
        "  ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"DirectoryQ", "[", "dir", "]"}]}], ",", "\n", "    ", 
          RowBox[{
           RowBox[{"Print", "[", 
            
            RowBox[{"\"\<WARNING: missing well directory: \>\"", ",", " ", 
             "dir"}], "]"}], ";", "\n", "    ", 
           RowBox[{"Return", "[", 
            RowBox[{"{", "}"}], "]"}], ";"}]}], "\n", "  ", "]"}], ";", "\n", 
        "\n", "  ", 
        RowBox[{"Select", "[", "\n", "    ", 
         RowBox[{
          RowBox[{"FileNames", "[", 
           RowBox[{"\"\<*.png\>\"", ",", " ", "dir"}], "]"}], ",", "\n", 
          "    ", 
          RowBox[{
           RowBox[{"With", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"len", " ", "=", " ", 
               RowBox[{"StringCases", "[", 
                RowBox[{"#", ",", " ", 
                 RowBox[{
                  RowBox[{"\"\<len_\>\"", " ", "~~", " ", 
                   RowBox[{"x", ":", "NumberString"}]}], " ", ":>", " ", 
                  RowBox[{"ToExpression", "[", "x", "]"}]}]}], "]"}]}], "}"}],
              ",", "\n", "      ", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "len", "]"}], " ", ">", " ", "0"}], " ",
               "&&", " ", 
              RowBox[{
               RowBox[{"Last", "[", "len", "]"}], " ", ">", " ", 
               "minLen"}]}]}], "\n", "    ", "]"}], " ", "&"}]}], "\n", "  ", 
         "]"}]}]}], "\n", "]"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"selectedFilesByWell", " ", "=", " ", 
     RowBox[{"AssociationThread", "[", 
      RowBox[{"wellIDs", ",", " ", 
       RowBox[{"getSelectedFilesForWell", " ", "/@", " ", "wellIDs"}]}], 
      "]"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"allSelectedFiles", " ", "=", " ", 
     RowBox[{"Flatten", "[", 
      RowBox[{"Values", "[", "selectedFilesByWell", "]"}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"allSelectedWells", " ", "=", " ", 
     RowBox[{"Flatten", " ", "@", " ", 
      RowBox[{"KeyValueMap", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ConstantArray", "[", 
          RowBox[{"#1", ",", " ", 
           RowBox[{"Length", "[", "#2", "]"}]}], "]"}], " ", "&"}], ",", " ", 
        "selectedFilesByWell"}], "]"}]}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"\"\<Total files selected: \>\"", ",", " ", 
      RowBox[{"Length", "[", "allSelectedFiles", "]"}]}], "]"}], ";"}], "\n", 
   "\n"}]}]], "Code",
 CellChangeTimes->{{3.974908915594068*^9, 3.974909046706008*^9}, 
   3.974909367293461*^9, 3.9749982862176523`*^9, 3.974998716356735*^9, {
   3.9749993446172867`*^9, 3.9749993710728683`*^9}, {3.97550287629461*^9, 
   3.975502930626628*^9}, {3.975504399846341*^9, 3.9755044055447083`*^9}, {
   3.975507984410534*^9, 3.975507987890657*^9}, {3.9755080695301437`*^9, 
   3.97550807047209*^9}, {3.975508110370232*^9, 3.9755081264351997`*^9}, {
   3.975509592086091*^9, 3.975509593055007*^9}, 3.9755097411887083`*^9, 
   3.975523269935768*^9, {3.9755234366890163`*^9, 3.97552348081032*^9}, {
   3.975523677393091*^9, 3.975523680387887*^9}, {3.975525141918971*^9, 
   3.975525150269004*^9}, {3.975588459282461*^9, 3.9755885842055264`*^9}, {
   3.975588716182225*^9, 3.9755887174239492`*^9}, {3.975590934497426*^9, 
   3.9755909356096*^9}, {3.9755911027355223`*^9, 3.975591103842938*^9}},
 CellLabel->"In[10]:=",ExpressionUUID->"dff84555-3aa1-455a-8776-d2f17fc6c998"],

Cell[CellGroupData[{

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Output directory: \"\>", 
   "\[InvisibleSpace]", \
"\<\"/Users/aweiner/beehive/lab/ConklinLabMFN2Data/processed_kymographs/\
250310_D10/processed_on_20251024/kymobutler_outputs\"\>"}],
  SequenceForm[
  "Output directory: ", 
   "/Users/aweiner/beehive/lab/ConklinLabMFN2Data/processed_kymographs/250310_\
D10/processed_on_20251024/kymobutler_outputs"],
  Editable->False]], "Print",
 CellChangeTimes->{3.9755921846322603`*^9},
 CellLabel->
  "During evaluation of \
In[10]:=",ExpressionUUID->"c5851644-a2cf-4710-bcc1-8c8eeb9bc8f8"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Total files selected: \"\>", "\[InvisibleSpace]", "78"}],
  SequenceForm["Total files selected: ", 78],
  Editable->False]], "Print",
 CellChangeTimes->{3.975592184798504*^9},
 CellLabel->
  "During evaluation of \
In[10]:=",ExpressionUUID->"88b66682-69e0-42dd-8132-b9544bba5ad3"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"allResults", " ", "=", " ", 
    RowBox[{"Table", "[", "\n", "  ", 
     RowBox[{
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"importedImage", ",", " ", "result"}], "}"}], ",", "\n", 
        "    ", 
        RowBox[{
         RowBox[{"importedImage", " ", "=", " ", 
          RowBox[{"Import", "[", 
           RowBox[{"allSelectedFiles", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ";", "\n", "\n", "    ", 
         
         RowBox[{"result", " ", "=", " ", 
          RowBox[{"BiKymoButler", "[", "\n", "      ", 
           RowBox[{
           "importedImage", ",", "\n", "      ", "0.2", ",", 
            "                 ", 
            RowBox[{"(*", " ", 
             RowBox[{"Detection", " ", "Threshold"}], " ", "*)"}], "\n", 
            "      ", "0.5", ",", "                 ", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{"Decision", " ", "Threshold"}], " ", "-", " ", 
              RowBox[{"do", " ", "not", " ", "change"}]}], " ", "*)"}], "\n", 
            "      ", "\"\<CPU\>\"", ",", "               ", 
            RowBox[{"(*", " ", 
             RowBox[{"Target", " ", "Device", " ", 
              RowBox[{"(", 
               RowBox[{"\"\<GPU\>\"", " ", "or", " ", "\"\<CPU\>\""}], 
               ")"}]}], " ", "*)"}], "\n", "      ", 
            RowBox[{"models", "[", "\"\<binet\>\"", "]"}], ",", "\n", 
            "      ", 
            RowBox[{"models", "[", "\"\<decnet\>\"", "]"}], ",", "\n", 
            "      ", "10", ",", "                  ", 
            RowBox[{"(*", " ", 
             RowBox[{"Minimum", " ", "Particle", " ", "Size"}], " ", "*)"}], 
            "\n", "      ", "3"}], "                    ", 
           RowBox[{"(*", " ", 
            RowBox[{"Minimum", " ", "Frame", " ", "Number"}], " ", "*)"}], 
           "\n", "    ", "]"}]}], ";", "\n", "\n", "    ", "result"}]}], "\n",
        "  ", "]"}], ",", "\n", "  ", 
      RowBox[{"{", 
       RowBox[{"i", ",", " ", 
        RowBox[{"Length", "[", "allSelectedFiles", "]"}]}], "}"}]}], "\n", 
     "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"\"\<Done running bidirectional kymobutler on \>\"", ",", " ", 
    RowBox[{"Length", "[", "allSelectedFiles", "]"}], ",", 
    " ", "\"\< kymographs\>\""}], "]"}], ";"}]}], "Code",
 CellChangeTimes->{
  3.974900729908243*^9, {3.9749007741134977`*^9, 3.9749007773839703`*^9}, {
   3.974904812603591*^9, 3.974904815079691*^9}, 3.974998707472033*^9, 
   3.97499876575496*^9, {3.9749994483745737`*^9, 3.97499948115884*^9}, {
   3.975074244455614*^9, 3.975074267416767*^9}, {3.975076916354075*^9, 
   3.9750769174423237`*^9}, {3.975091183951395*^9, 3.975091225093617*^9}, 
   3.9755081433166656`*^9, 3.975508272922826*^9, {3.975525173574356*^9, 
   3.975525227334455*^9}},
 CellLabel->"In[24]:=",ExpressionUUID->"8fc9e271-e259-4c24-86ae-a87bf503f131"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Done running bidirectional kymobutler on \"\>", "\[InvisibleSpace]",
    "78", "\[InvisibleSpace]", "\<\" kymographs\"\>"}],
  SequenceForm["Done running bidirectional kymobutler on ", 78, " kymographs"],
  Editable->False]], "Print",
 CellChangeTimes->{3.975592377375909*^9},
 CellLabel->
  "During evaluation of \
In[24]:=",ExpressionUUID->"a6dd09d4-8be2-4f02-962d-b9a086f3263b"]
}, Open  ]],

Cell[BoxData[""], "Code",
 CellChangeTimes->{
  3.974901182539029*^9, 3.974901404170188*^9, 3.97490151230262*^9, {
   3.974902293814825*^9, 3.974902337594329*^9}, {3.9749023902756767`*^9, 
   3.9749023920589647`*^9}, {3.974902433411059*^9, 3.974902453209046*^9}, {
   3.974902503718144*^9, 3.974902520243215*^9}, {3.9749028603201*^9, 
   3.974902888454232*^9}, {3.9749036139383287`*^9, 3.974903643416851*^9}, {
   3.97490368465324*^9, 3.974903686267241*^9}, {3.974903828642254*^9, 
   3.974903835863719*^9}, 3.974904101827272*^9, {3.974904222277213*^9, 
   3.974904223363822*^9}, 3.974909095758822*^9, {3.974909266580583*^9, 
   3.9749092686347837`*^9}, {3.974909418785261*^9, 3.974909453939452*^9}, {
   3.974909512306019*^9, 3.9749095192735977`*^9}, {3.9749099866187973`*^9, 
   3.974909998974695*^9}, {3.9749157478281803`*^9, 3.9749157503648167`*^9}, 
   3.97499827168246*^9, 3.9749987705916157`*^9, 3.97517021814834*^9, 
   3.975524909511286*^9, {3.975525044040907*^9, 3.975525049537216*^9}, {
   3.975525082797633*^9, 3.975525085315669*^9}, 
   3.9755923814959106`*^9},ExpressionUUID->"7dd2d715-47a8-4290-b207-\
cd93dbe115cb"],

Cell[BoxData[""], "Code",
 CellChangeTimes->{{3.97490429951071*^9, 3.97490431008808*^9}, {
   3.974904350501337*^9, 3.9749044143837423`*^9}, {3.9749044636795177`*^9, 
   3.974904512346211*^9}, {3.9749045921859713`*^9, 3.974904592414585*^9}, {
   3.974904636110298*^9, 3.974904678988264*^9}, 3.974909630595982*^9, {
   3.974909712534782*^9, 3.9749097549206142`*^9}, {3.974909839610032*^9, 
   3.974909863170228*^9}, {3.9749099555995197`*^9, 3.974909958123749*^9}, {
   3.974910100607944*^9, 3.974910189320994*^9}, {3.974910251305361*^9, 
   3.9749102709430656`*^9}, 3.9749105392516193`*^9, 3.974998720805408*^9, 
   3.974998776865753*^9, 3.975170209755661*^9},
 CellLabel->"In[26]:=",ExpressionUUID->"3a744eb5-64ef-40e4-9e90-04da788ac6b6"],

Cell[BoxData[""], "Code",
 CellChangeTimes->{
  3.974910565021721*^9, 3.9749982681049843`*^9, {3.9750733176670017`*^9, 
   3.9750734314984627`*^9}, {3.975073631806782*^9, 3.975073637219852*^9}, {
   3.975074016496296*^9, 3.975074017432351*^9}, {3.975081840552647*^9, 
   3.975081847282469*^9}, {3.975081879662133*^9, 3.97508190129289*^9}, {
   3.9751701955142097`*^9, 3.9751702435815496`*^9}},
 CellLabel->"In[27]:=",ExpressionUUID->"a8c8a005-c579-481c-9816-2f9b576cf2f8"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\n", 
  RowBox[{
   RowBox[{
    RowBox[{"$RecursionLimit", " ", "=", " ", "4096"}], ";"}], "\n", "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
    "===", "===", "===", "===", "===", "===", "===", "===", "===", "=="}], 
    " ", "*)"}], "\n", 
   RowBox[{"(*", " ", 
    RowBox[{"Initialize", " ", "storage", " ", "per", " ", "well"}], "   ", 
    "*)"}], "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
    "===", "===", "===", "===", "===", "===", "===", "===", "===", "=="}], 
    " ", "*)"}], "\n", "\n", 
   RowBox[{
    RowBox[{"resultsByWell", " ", "=", " ", 
     RowBox[{"Association", "[", "\n", "  ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"wellID", " ", "->", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"wellID", ",", " ", "wellIDs"}], "}"}]}], "]"}], "\n", 
      "]"}]}], ";"}], "\n", "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
    "===", "===", "===", "===", "===", "===", "===", "===", "===", "=="}], 
    " ", "*)"}], "\n", 
   RowBox[{"(*", " ", 
    RowBox[{"Process", " ", "all", " ", "kymographs"}], "        ", "*)"}], 
   "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
    "===", "===", "===", "===", "===", "===", "===", "===", "===", "=="}], 
    " ", "*)"}], "\n", "\n", 
   RowBox[{
    RowBox[{"Do", "[", "\n", "  ", 
     RowBox[{
      RowBox[{"Module", "[", "\n", "    ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "well", ",", " ", "fileName", ",", " ", "processed", ",", " ", 
          "dataset", ",", " ", "labeledRows"}], "}"}], ",", "\n", "\n", 
        "    ", 
        RowBox[{
         RowBox[{"well", " ", "=", " ", 
          RowBox[{"allSelectedWells", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", "\n", "    ", 
         RowBox[{"fileName", " ", "=", " ", 
          RowBox[{"FileNameTake", "[", 
           RowBox[{"allSelectedFiles", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ";", "\n", "\n", "    ", 
         
         RowBox[{"(*", " ", 
          RowBox[{"Process", " ", "tracks"}], " ", "*)"}], "\n", "    ", 
         RowBox[{"processed", " ", "=", " ", 
          RowBox[{"pprocLocal", "[", "\n", "      ", 
           RowBox[{
            RowBox[{"allResults", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", " ", 
               RowBox[{"-", "1"}]}], "]"}], "]"}], ",", "\n", "      ", 
            "secPerFrame", ",", "\n", "      ", "umPerPixel"}], "\n", "    ", 
           "]"}]}], ";", "\n", "\n", "    ", 
         RowBox[{"(*", " ", 
          RowBox[{"Extract", " ", "numeric", " ", "table"}], " ", "*)"}], 
         "\n", "    ", 
         RowBox[{"dataset", " ", "=", " ", 
          RowBox[{"Normal", "@", 
           RowBox[{"processed", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"-", "1"}], ",", " ", 
              RowBox[{"2", " ", ";;"}]}], "]"}], "]"}]}]}], ";", "\n", "\n", 
         "    ", 
         RowBox[{"(*", " ", 
          RowBox[{
          "Remove", " ", "header", " ", "row", " ", "if", " ", "present"}], 
          " ", "*)"}], "\n", "    ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"StringQ", "[", 
            RowBox[{"dataset", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", " ", "1"}], "]"}], "]"}], "]"}], ",", " ", 
           RowBox[{"dataset", " ", "=", " ", 
            RowBox[{"Rest", "[", "dataset", "]"}]}]}], "]"}], ";", "\n", "\n",
          "    ", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"Add", " ", "well"}], " ", "+", " ", "filename"}], " ", 
          "*)"}], "\n", "    ", 
         RowBox[{"labeledRows", " ", "=", " ", 
          RowBox[{"Map", "[", "\n", "      ", 
           RowBox[{
            RowBox[{
             RowBox[{"Prepend", "[", 
              RowBox[{
               RowBox[{"Append", "[", 
                RowBox[{"#", ",", " ", "fileName"}], "]"}], ",", " ", 
               "well"}], "]"}], " ", "&"}], ",", "\n", "      ", "dataset"}], 
           "\n", "    ", "]"}]}], ";", "\n", "\n", "    ", 
         RowBox[{"(*", " ", 
          RowBox[{
          "Append", " ", "to", " ", "the", " ", "correct", " ", "well", " ", 
           "bucket"}], " ", "*)"}], "\n", "    ", 
         RowBox[{
          RowBox[{"resultsByWell", "[", "well", "]"}], " ", "=", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"resultsByWell", "[", "well", "]"}], ",", " ", 
            "labeledRows"}], "]"}]}], ";"}]}], "\n", "  ", "]"}], ",", "\n", 
      "  ", 
      RowBox[{"{", 
       RowBox[{"i", ",", " ", 
        RowBox[{"Length", "[", "allSelectedFiles", "]"}]}], "}"}]}], "\n", 
     "]"}], ";"}], "\n", "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
    "===", "===", "===", "===", "===", "===", "===", "===", "===", "=="}], 
    " ", "*)"}], "\n", 
   RowBox[{"(*", " ", 
    RowBox[{"Write", " ", "one", " ", "CSV", " ", "per", " ", "well"}], 
    "        ", "*)"}], "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
    "===", "===", "===", "===", "===", "===", "===", "===", "===", "=="}], 
    " ", "*)"}], "\n", "\n", 
   RowBox[{
    RowBox[{"header", " ", "=", " ", 
     RowBox[{"{", "\n", "  ", 
      RowBox[{"\"\<well_id\>\"", ",", "\n", "  ", "\"\<Direction\>\"", ",", 
       "\n", "  ", "\"\<Velocity\>\"", ",", "\n", "  ", "\"\<Duration\>\"", ",",
        "\n", "  ", "\"\<Distance\>\"", ",", "\n", 
       "  ", "\"\<Instant_velocity\>\"", ",", "\n", 
       "  ", "\"\<FileName\>\""}], "\n", "}"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"Do", "[", "\n", "  ", 
     RowBox[{
      RowBox[{"Module", "[", "\n", "    ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"rows", ",", " ", "combinedCSV", ",", " ", "outFile"}], 
         "}"}], ",", "\n", "\n", "    ", 
        RowBox[{
         RowBox[{"rows", " ", "=", " ", 
          RowBox[{"resultsByWell", "[", "well", "]"}]}], ";", "\n", "\n", 
         "    ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "rows", "]"}], " ", "==", " ", "0"}], ",", 
           "\n", "      ", 
           RowBox[{
            RowBox[{"Print", "[", 
             
             RowBox[{"\"\<Skipping well \>\"", ",", " ", "well", ",", 
              " ", "\"\< (no data).\>\""}], "]"}], ";", "\n", "      ", 
            RowBox[{"Continue", "[", "]"}], ";"}]}], "\n", "    ", "]"}], ";",
          "\n", "\n", "    ", 
         RowBox[{"combinedCSV", " ", "=", " ", 
          RowBox[{"Prepend", "[", 
           RowBox[{"rows", ",", " ", "header"}], "]"}]}], ";", "\n", "\n", 
         "    ", 
         RowBox[{"outFile", " ", "=", " ", 
          RowBox[{"FileNameJoin", "[", "\n", "      ", 
           RowBox[{"{", 
            RowBox[{"outputDir", ",", " ", 
             RowBox[{
             "well", " ", "<>", " ", "\"\<_combined_results.csv\>\""}]}], 
            "}"}], "\n", "    ", "]"}]}], ";", "\n", "\n", "    ", 
         RowBox[{"Export", "[", 
          RowBox[{
          "outFile", ",", " ", "combinedCSV", ",", " ", "\"\<CSV\>\""}], 
          "]"}], ";", "\n", "\n", "    ", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Wrote \>\"", ",", " ", 
           RowBox[{"Length", "[", "rows", "]"}], ",", " ", "\"\< rows to \>\"",
            ",", " ", "outFile"}], "]"}], ";"}]}], "\n", "  ", "]"}], ",", 
      "\n", "  ", 
      RowBox[{"{", 
       RowBox[{"well", ",", " ", "wellIDs"}], "}"}]}], "\n", "]"}], ";"}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{"Print", "[", "\"\<Done writing per-well CSV files.\>\"", "]"}], 
    ";"}], "\n"}]}]], "Code",
 CellChangeTimes->{
  3.9749105901200857`*^9, 3.974998258840815*^9, 3.9750736461057262`*^9, {
   3.975073685585705*^9, 3.9750737097864857`*^9}, 3.975074048586532*^9, {
   3.975074147316221*^9, 3.975074157040979*^9}, {3.975081942777853*^9, 
   3.975081945443656*^9}, {3.975087740434565*^9, 3.97508781029314*^9}, {
   3.975087847146824*^9, 3.97508784766348*^9}, {3.975087878673893*^9, 
   3.975087970656839*^9}, 3.9750880117865047`*^9, {3.975088047424822*^9, 
   3.975088128777154*^9}, {3.975088159475161*^9, 3.97508820138269*^9}, {
   3.975088288270185*^9, 3.975088288657881*^9}, {3.975088751292532*^9, 
   3.975088752023637*^9}, 3.975088812396777*^9, {3.9750890224588833`*^9, 
   3.975089029231979*^9}, {3.9750892735681868`*^9, 3.975089331526124*^9}, {
   3.975089586020636*^9, 3.9750895986295013`*^9}, {3.9751607112281322`*^9, 
   3.975160763734222*^9}, {3.975168731792296*^9, 3.975168738099584*^9}, {
   3.975169193814886*^9, 3.975169203046006*^9}, {3.9751693595352087`*^9, 
   3.975169406704883*^9}, {3.975169440362306*^9, 3.975169441327655*^9}, {
   3.975169741430449*^9, 3.9751697691847057`*^9}, {3.9751699450286427`*^9, 
   3.975169971297769*^9}, {3.9755027349429817`*^9, 3.975502777196477*^9}, {
   3.975502817932304*^9, 3.975502832886223*^9}, {3.9755045299769506`*^9, 
   3.975504541535528*^9}, {3.9755083357419653`*^9, 3.975508336803738*^9}, {
   3.975508368656251*^9, 3.9755083697291307`*^9}, {3.975508403982349*^9, 
   3.975508406359514*^9}, {3.975508466384646*^9, 3.9755084966874847`*^9}, {
   3.9755085471970577`*^9, 3.975508587507639*^9}, {3.975508659631044*^9, 
   3.975508667987089*^9}, {3.975510176979868*^9, 3.975510187481769*^9}, 
   3.975516546674368*^9, {3.975516725649969*^9, 3.975516760673458*^9}, {
   3.975524322729974*^9, 3.975524324315835*^9}, {3.975524575658243*^9, 
   3.975524577006419*^9}, {3.975525280102666*^9, 3.975525291437276*^9}, {
   3.9755884514586773`*^9, 3.975588452129923*^9}, {3.975589201063545*^9, 
   3.975589208407754*^9}, 
   3.975592496925209*^9},ExpressionUUID->"6e56728e-19b6-40d6-b515-\
e74a082bfe4e"],

Cell[CellGroupData[{

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Wrote \"\>", "\[InvisibleSpace]", "446", 
   "\[InvisibleSpace]", "\<\" rows to \"\>", 
   "\[InvisibleSpace]", \
"\<\"/Users/aweiner/beehive/lab/ConklinLabMFN2Data/processed_kymographs/\
250310_D10/processed_on_20251024/kymobutler_outputs/B02_combined_results.csv\"\
\>"}],
  SequenceForm[
  "Wrote ", 446, " rows to ", 
   "/Users/aweiner/beehive/lab/ConklinLabMFN2Data/processed_kymographs/250310_\
D10/processed_on_20251024/kymobutler_outputs/B02_combined_results.csv"],
  Editable->False]], "Print",
 CellChangeTimes->{3.975592388402749*^9},
 CellLabel->
  "During evaluation of \
In[26]:=",ExpressionUUID->"82dfd602-76eb-45ba-b81f-320e746f3cd8"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Wrote \"\>", "\[InvisibleSpace]", "661", 
   "\[InvisibleSpace]", "\<\" rows to \"\>", 
   "\[InvisibleSpace]", \
"\<\"/Users/aweiner/beehive/lab/ConklinLabMFN2Data/processed_kymographs/\
250310_D10/processed_on_20251024/kymobutler_outputs/B03_combined_results.csv\"\
\>"}],
  SequenceForm[
  "Wrote ", 661, " rows to ", 
   "/Users/aweiner/beehive/lab/ConklinLabMFN2Data/processed_kymographs/250310_\
D10/processed_on_20251024/kymobutler_outputs/B03_combined_results.csv"],
  Editable->False]], "Print",
 CellChangeTimes->{3.975592388480444*^9},
 CellLabel->
  "During evaluation of \
In[26]:=",ExpressionUUID->"1bdb8553-1113-4c68-915a-56db61b6ec81"],

Cell[BoxData["\<\"Done writing per-well CSV files.\"\>"], "Print",
 CellChangeTimes->{3.9755923884813843`*^9},
 CellLabel->
  "During evaluation of \
In[26]:=",ExpressionUUID->"e1924fd6-252c-40b4-a3f7-b18bbd90264e"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "===", "===", "===", "===", "===", "===", "===", "===", "===", "=="}], " ",
    "*)"}], "\n", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Export", " ", "pixel"}], "-", 
    RowBox[{"level", " ", "tracks"}]}], "     ", "*)"}], "\n", 
  RowBox[{"(*", " ", 
   RowBox[{
   "===", "===", "===", "===", "===", "===", "===", "===", "===", "=="}], " ",
    "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"pixelHeader", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"\"\<well_id\>\"", ",", " ", "\"\<FileName\>\"", ",", 
       " ", "\"\<track_id\>\"", ",", " ", "\"\<px\>\"", ",", 
       " ", "\"\<py\>\""}], "}"}]}], ";"}], "\n", "\n", 
   RowBox[{"(*", " ", 
    RowBox[{"Initialize", " ", "storage", " ", "per", " ", "well"}], " ", 
    "*)"}], "\n", 
   RowBox[{
    RowBox[{"pixelRowsByWell", " ", "=", " ", 
     RowBox[{"Association", "[", "\n", "  ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"wellID", " ", "->", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"wellID", ",", " ", "wellIDs"}], "}"}]}], "]"}], "\n", 
      "]"}]}], ";"}], "\n", "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
    "===", "===", "===", "===", "===", "===", "===", "===", "===", "=="}], 
    " ", "*)"}], "\n", 
   RowBox[{"(*", " ", 
    RowBox[{"Accumulate", " ", "pixel", " ", "rows"}], "         ", "*)"}], 
   "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
    "===", "===", "===", "===", "===", "===", "===", "===", "===", "=="}], 
    " ", "*)"}], "\n", "\n", 
   RowBox[{
    RowBox[{"Do", "[", "\n", "  ", 
     RowBox[{
      RowBox[{"Module", "[", "\n", "    ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "well", ",", " ", "fileName", ",", " ", "tracks", ",", " ", "rows"}],
          "}"}], ",", "\n", "\n", "    ", 
        RowBox[{
         RowBox[{"well", " ", "=", " ", 
          RowBox[{"allSelectedWells", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", "\n", "    ", 
         RowBox[{"fileName", " ", "=", " ", 
          RowBox[{"FileNameTake", "[", 
           RowBox[{"allSelectedFiles", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ";", "\n", "    ", 
         RowBox[{"tracks", " ", "=", " ", 
          RowBox[{"allResults", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", " ", 
             RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", "\n", "\n", "    ", 
         RowBox[{"(*", " ", 
          RowBox[{
          "Skip", " ", "if", " ", "no", " ", "tracks", " ", "or", " ", 
           "malformed"}], " ", "*)"}], "\n", "    ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"!", 
             RowBox[{"ListQ", "[", "tracks", "]"}]}], " ", "||", " ", 
            RowBox[{
             RowBox[{"Length", "[", "tracks", "]"}], " ", "==", " ", "0"}]}], 
           ",", "\n", "      ", 
           RowBox[{
            RowBox[{"Return", "[", "]"}], ";"}]}], "\n", "    ", "]"}], ";", 
         "\n", "\n", "    ", 
         RowBox[{"rows", " ", "=", "\n", "      ", 
          RowBox[{"Flatten", "[", "\n", "        ", 
           RowBox[{
            RowBox[{"Table", "[", "\n", "          ", 
             RowBox[{
              RowBox[{"With", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"trackID", " ", "=", " ", "t"}], "}"}], ",", "\n", 
                "            ", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    "well", ",", " ", "fileName", ",", " ", "trackID", ",", 
                    " ", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}], " ", "&"}], 
                  ")"}], " ", "/@", "\n", "              ", 
                 RowBox[{"tracks", "[", 
                  RowBox[{"[", "t", "]"}], "]"}]}]}], "\n", "          ", 
               "]"}], ",", "\n", "          ", 
              RowBox[{"{", 
               RowBox[{"t", ",", " ", 
                RowBox[{"Length", "[", "tracks", "]"}]}], "}"}]}], "\n", 
             "        ", "]"}], ",", "\n", "        ", "1"}], "\n", "      ", 
           "]"}]}], ";", "\n", "\n", "    ", 
         RowBox[{"(*", " ", 
          RowBox[{"Append", " ", "to", " ", "correct", " ", "well"}], " ", 
          "*)"}], "\n", "    ", 
         RowBox[{
          RowBox[{"pixelRowsByWell", "[", "well", "]"}], " ", "=", "\n", 
          "      ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"pixelRowsByWell", "[", "well", "]"}], ",", " ", "rows"}],
            "]"}]}], ";"}]}], "\n", "  ", "]"}], ",", "\n", "  ", 
      RowBox[{"{", 
       RowBox[{"i", ",", " ", 
        RowBox[{"Length", "[", "allResults", "]"}]}], "}"}]}], "\n", "]"}], 
    ";"}], "\n", "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
    "===", "===", "===", "===", "===", "===", "===", "===", "===", "=="}], 
    " ", "*)"}], "\n", 
   RowBox[{"(*", " ", 
    RowBox[{"Write", " ", "one", " ", "CSV", " ", "per", " ", "well"}], 
    "        ", "*)"}], "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
    "===", "===", "===", "===", "===", "===", "===", "===", "===", "=="}], 
    " ", "*)"}], "\n", "\n", 
   RowBox[{
    RowBox[{"Do", "[", "\n", "  ", 
     RowBox[{
      RowBox[{"Module", "[", "\n", "    ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"rows", ",", " ", "pixelTable", ",", " ", "outFile"}], "}"}],
         ",", "\n", "\n", "    ", 
        RowBox[{
         RowBox[{"rows", " ", "=", " ", 
          RowBox[{"pixelRowsByWell", "[", "well", "]"}]}], ";", "\n", "\n", 
         "    ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "rows", "]"}], " ", "==", " ", "0"}], ",", 
           "\n", "      ", 
           RowBox[{
            RowBox[{"Print", "[", 
             
             RowBox[{"\"\<Skipping well \>\"", ",", " ", "well", ",", 
              " ", "\"\< (no pixel tracks).\>\""}], "]"}], ";", "\n", 
            "      ", 
            RowBox[{"Continue", "[", "]"}], ";"}]}], "\n", "    ", "]"}], ";",
          "\n", "\n", "    ", 
         RowBox[{"pixelTable", " ", "=", " ", 
          RowBox[{"Prepend", "[", 
           RowBox[{"rows", ",", " ", "pixelHeader"}], "]"}]}], ";", "\n", 
         "\n", "    ", 
         RowBox[{"outFile", " ", "=", " ", 
          RowBox[{"FileNameJoin", "[", "\n", "      ", 
           RowBox[{"{", 
            RowBox[{"outputDir", ",", " ", 
             RowBox[{"well", " ", "<>", " ", "\"\<_pixel_tracks.csv\>\""}]}], 
            "}"}], "\n", "    ", "]"}]}], ";", "\n", "\n", "    ", 
         RowBox[{"Export", "[", 
          RowBox[{
          "outFile", ",", " ", "pixelTable", ",", " ", "\"\<CSV\>\""}], "]"}],
          ";", "\n", "\n", "    ", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Wrote \>\"", ",", " ", 
           RowBox[{"Length", "[", "rows", "]"}], ",", 
           " ", "\"\< pixel rows to \>\"", ",", " ", "outFile"}], "]"}], 
         ";"}]}], "\n", "  ", "]"}], ",", "\n", "  ", 
      RowBox[{"{", 
       RowBox[{"well", ",", " ", "wellIDs"}], "}"}]}], "\n", "]"}], ";"}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{
    "Print", "[", "\"\<Done writing per-well pixel track CSV files.\>\"", 
     "]"}], ";"}], "\n", "\n"}]}]], "Code",
 CellChangeTimes->{
  3.974910631528878*^9, {3.974911128684638*^9, 3.974911173773078*^9}, 
   3.974911234447707*^9, {3.974911289826839*^9, 3.974911292655067*^9}, {
   3.974911377640935*^9, 3.974911379700645*^9}, {3.974912551502076*^9, 
   3.9749125541553783`*^9}, 3.974916018358779*^9, {3.974916129450596*^9, 
   3.9749161334008493`*^9}, 3.974916182728559*^9, 3.97491621736696*^9, 
   3.974916267551053*^9, 3.9749943720784082`*^9, 3.9749987632168007`*^9, 
   3.975088051435755*^9, 3.975088138603673*^9, 3.975088224528331*^9, {
   3.9750887903435993`*^9, 3.975088807731847*^9}, {3.9751701849413157`*^9, 
   3.975170187474419*^9}, {3.9755170139738407`*^9, 3.97551704133228*^9}, {
   3.975520407771566*^9, 3.975520424491939*^9}, 3.975522433900157*^9, {
   3.975591941457156*^9, 3.975591945539892*^9}, {3.975592486136385*^9, 
   3.975592488699173*^9}},ExpressionUUID->"fb56a14c-33f3-45a9-aebc-\
91093856ce26"],

Cell[CellGroupData[{

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Wrote \"\>", "\[InvisibleSpace]", "31234", 
   "\[InvisibleSpace]", "\<\" pixel rows to \"\>", 
   "\[InvisibleSpace]", \
"\<\"/Users/aweiner/beehive/lab/ConklinLabMFN2Data/processed_kymographs/\
250310_D10/processed_on_20251024/kymobutler_outputs/B02_pixel_tracks.csv\"\>"}\
],
  SequenceForm[
  "Wrote ", 31234, " pixel rows to ", 
   "/Users/aweiner/beehive/lab/ConklinLabMFN2Data/processed_kymographs/250310_\
D10/processed_on_20251024/kymobutler_outputs/B02_pixel_tracks.csv"],
  Editable->False]], "Print",
 CellChangeTimes->{3.9755923971066732`*^9},
 CellLabel->
  "During evaluation of \
In[32]:=",ExpressionUUID->"9f289798-56fa-44d7-846f-76fca49003f1"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Wrote \"\>", "\[InvisibleSpace]", "47332", 
   "\[InvisibleSpace]", "\<\" pixel rows to \"\>", 
   "\[InvisibleSpace]", \
"\<\"/Users/aweiner/beehive/lab/ConklinLabMFN2Data/processed_kymographs/\
250310_D10/processed_on_20251024/kymobutler_outputs/B03_pixel_tracks.csv\"\>"}\
],
  SequenceForm[
  "Wrote ", 47332, " pixel rows to ", 
   "/Users/aweiner/beehive/lab/ConklinLabMFN2Data/processed_kymographs/250310_\
D10/processed_on_20251024/kymobutler_outputs/B03_pixel_tracks.csv"],
  Editable->False]], "Print",
 CellChangeTimes->{3.975592397483653*^9},
 CellLabel->
  "During evaluation of \
In[32]:=",ExpressionUUID->"0e9e776b-faea-413a-8122-da103b895cab"],

Cell[BoxData["\<\"Done writing per-well pixel track CSV files.\"\>"], "Print",
 CellChangeTimes->{3.975592397485899*^9},
 CellLabel->
  "During evaluation of \
In[32]:=",ExpressionUUID->"909621cf-de73-4d1d-ac37-17ec580c0be6"]
}, Open  ]]
}, Open  ]],

Cell[BoxData[""], "Code",
 CellChangeTimes->{
  3.974910668670277*^9, 3.974911125434813*^9, {3.9749116226097307`*^9, 
   3.974911623465859*^9}, 3.974916072909173*^9, 3.9749162889010677`*^9, {
   3.974916417398377*^9, 3.97491643359874*^9}, {3.97499824889963*^9, 
   3.9749982516125097`*^9}},
 CellLabel->"In[39]:=",ExpressionUUID->"20649f0d-ffa0-412f-8278-368a4f8257e7"],

Cell[BoxData[""], "Code",
 CellChangeTimes->{
  3.974910695254521*^9, 3.974911120687056*^9, 3.974916440914446*^9, {
   3.974917554424926*^9, 3.974917556055444*^9}, 3.974982052399424*^9, 
   3.9749982472071667`*^9},
 CellLabel->"In[40]:=",ExpressionUUID->"8612960f-105d-4155-9d10-6e95990fdc1b"],

Cell[BoxData[""], "Code",
 CellChangeTimes->{
  3.974910744743367*^9, 3.974911118748417*^9, 3.9749177601693773`*^9, 
   3.9749192271534033`*^9, {3.974919330141637*^9, 3.974919331902233*^9}, 
   3.974920562948639*^9, {3.974996150268187*^9, 3.9749961625030317`*^9}, {
   3.974998186154849*^9, 3.974998234387356*^9}, 3.974998769043476*^9},
 CellLabel->"In[41]:=",ExpressionUUID->"dfd9cc79-b3db-499b-833e-be5fb4176270"],

Cell[BoxData[""], "Code",
 CellChangeTimes->{
  3.9749107679347467`*^9, 3.974910803885386*^9, 3.9749108344358053`*^9, 
   3.9749111165863447`*^9, 3.974919218187686*^9, {3.9749220089697237`*^9, 
   3.974922056580632*^9}, {3.9749221010839243`*^9, 3.974922104921019*^9}, 
   3.9749222819289722`*^9, {3.974923579496056*^9, 3.974923586640747*^9}, {
   3.974982143651638*^9, 3.9749821469330683`*^9}, {3.9749954830937147`*^9, 
   3.974995484485796*^9}, {3.974996138754777*^9, 3.974996144907378*^9}, {
   3.974998132999078*^9, 3.9749981779322643`*^9}, 3.974998775034484*^9, 
   3.974998818480179*^9},
 CellLabel->"In[42]:=",ExpressionUUID->"ad31b1ce-13f2-4018-8baf-febb971acf60"],

Cell[BoxData[
 RowBox[{"\n", 
  RowBox[{
   RowBox[{
    RowBox[{"imageOutputDir", " ", "=", " ", 
     RowBox[{"FileNameJoin", "[", 
      RowBox[{"{", 
       RowBox[{"outputDir", ",", " ", "\"\<overlay_images\>\""}], "}"}], 
      "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"!", 
       RowBox[{"DirectoryQ", "[", "imageOutputDir", "]"}]}], ",", " ", 
      RowBox[{"CreateDirectory", "[", "imageOutputDir", "]"}]}], "]"}], ";"}],
    "\n", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"\"\<Image output directory: \>\"", ",", " ", "imageOutputDir"}],
      "]"}], ";"}], "\n", "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Loop", " ", "through", " ", "each", " ", "result", " ", "and", " ", 
     "save", " ", "the", " ", "third", " ", "element", " ", "as", " ", "an", " ",
      "image"}], " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{"Do", "[", "\n", "  ", 
     RowBox[{
      RowBox[{"Module", "[", "\n", "    ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"thirdElement", ",", " ", "outputPath"}], "}"}], ",", "\n", 
        "    ", 
        RowBox[{
         RowBox[{"thirdElement", " ", "=", " ", 
          RowBox[{"allResults", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", " ", "3"}], "]"}], "]"}]}], ";", " ", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
           "Extract", " ", "the", " ", "third", " ", "element", " ", "of", " ", 
            RowBox[{"the", " ", "'"}], "i"}], "-", 
           RowBox[{
            RowBox[{"th", "'"}], " ", "result"}]}], " ", "*)"}], "\n", "    ", 
         RowBox[{"well", " ", "=", " ", 
          RowBox[{"allSelectedWells", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", "\n", "\t", 
         RowBox[{"fileName", " ", "=", " ", 
          RowBox[{"FileBaseName", "[", 
           RowBox[{"FileNameTake", "[", 
            RowBox[{"allSelectedFiles", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}]}], ";", "\n", 
         "    ", "\n", "    ", 
         RowBox[{"outputPath", " ", "=", " ", 
          RowBox[{"FileNameJoin", "[", 
           RowBox[{"{", 
            RowBox[{"imageOutputDir", ",", " ", 
             RowBox[{
             "well", " ", "<>", " ", "\"\<_\>\"", " ", "<>", " ", "fileName", 
              " ", "<>", " ", "\"\<_overlay.png\>\""}]}], "}"}], "]"}]}], ";",
          "\n", "    ", "\n", "    ", 
         RowBox[{"Export", "[", 
          RowBox[{"outputPath", ",", " ", "thirdElement"}], "]"}]}]}], " ", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Save", " ", "the", " ", "third", " ", "element", " ", "as", " ", 
         "an", " ", "image"}], " ", "*)"}], "\n", "  ", "]"}], ",", "\n", 
      "  ", 
      RowBox[{"{", 
       RowBox[{"i", ",", " ", 
        RowBox[{"Length", "[", "allSelectedFiles", "]"}]}], "}"}]}], " ", 
     RowBox[{"(*", " ", 
      RowBox[{"Iterate", " ", "over", " ", "indices"}], " ", "*)"}], "\n", 
     "]"}], ";"}], "\n", 
   RowBox[{"Print", "[", 
    RowBox[{"\"\<Kymobutler results saved as PNG files for \>\"", ",", " ", 
     RowBox[{"Length", "[", "allSelectedFiles", "]"}], ",", 
     " ", "\"\< kymographs.\>\""}], "]"}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "outputDirectory", " ", "=", 
      " ", "\"\</Users/lepstein/KymoButler/kym_res\>\""}], ";", " ", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Replace", " ", "with", " ", "your", " ", "output", " ", "folder"}], 
      " ", "*)"}], "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Ensure", " ", "the", " ", "output", " ", "directory", " ", "exists"}], 
      " ", "*)"}], "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", " ", 
        RowBox[{"DirectoryQ", "[", "outputDirectory", "]"}]}], ",", " ", 
       RowBox[{"CreateDirectory", "[", "outputDirectory", "]"}]}], "]"}], ";",
      "\n", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Loop", " ", "through", " ", "each", " ", "result", " ", "and", " ", 
       "save", " ", "the", " ", "third", " ", "element", " ", "as", " ", "a", 
       " ", "text", " ", "file"}], " ", "*)"}], "\n", 
     RowBox[{"Do", "[", "\n", "  ", 
      RowBox[{
       RowBox[{"Module", "[", "\n", "    ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"thirdElement", ",", " ", "outputPath"}], "}"}], ",", "\n", 
         "    ", 
         RowBox[{
          RowBox[{"thirdElement", " ", "=", " ", 
           RowBox[{"results", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", " ", "3"}], "]"}], "]"}]}], ";", " ", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{
            "Extract", " ", "the", " ", "third", " ", "element", " ", "of", " ", 
             RowBox[{"the", " ", "'"}], "i"}], "-", 
            RowBox[{
             RowBox[{"th", "'"}], " ", "result"}]}], " ", "*)"}], "\n", 
          "    ", "\n", "    ", 
          RowBox[{"outputPath", " ", "=", " ", 
           RowBox[{"FileNameJoin", "[", 
            RowBox[{"{", 
             RowBox[{"outputDirectory", ",", " ", 
              RowBox[{"\"\<result_\>\"", " ", "<>", " ", 
               RowBox[{"ToString", "[", 
                RowBox[{"FileBaseName", "[", 
                 RowBox[{"selectedFiles", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], " ", "<>", 
               " ", "\"\<.txt\>\""}]}], "}"}], "]"}]}], ";", " ", 
          RowBox[{"(*", " ", 
           RowBox[{"Define", " ", "the", " ", "file", " ", "name"}], " ", 
           "*)"}], "\n", "    ", "\n", "    ", 
          RowBox[{"Export", "[", 
           RowBox[{
           "outputPath", ",", " ", "thirdElement", ",", " ", "\"\<Text\>\""}],
            "]"}]}]}], " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Save", " ", "the", " ", "third", " ", "element", " ", "as", " ", 
          RowBox[{"a", " ", ".", "txt"}], " ", "file"}], " ", "*)"}], "\n", 
        "  ", "]"}], ",", "\n", "  ", 
       RowBox[{"{", 
        RowBox[{"i", ",", " ", 
         RowBox[{"Length", "[", "selectedFiles", "]"}]}], "}"}]}], " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Iterate", " ", "over", " ", "indices", " ", "from", " ", "1", " ", 
        "to", " ", 
        RowBox[{"Length", "[", "results", "]"}]}], " ", "*)"}], "\n", "]"}], 
     ";"}], "*)"}]}]}]], "Code",
 CellChangeTimes->{{3.9749221481427107`*^9, 3.974922285904395*^9}, {
   3.9749237046327133`*^9, 3.97492371685952*^9}, {3.9749819744232903`*^9, 
   3.974981988035873*^9}, {3.974982059610235*^9, 3.974982088339533*^9}, {
   3.97498211840561*^9, 3.974982125706579*^9}, 3.974998295311228*^9, 
   3.9751702508499403`*^9, {3.975504504279499*^9, 3.9755045209301043`*^9}, {
   3.975508981164657*^9, 3.975508983192704*^9}, {3.975509027230741*^9, 
   3.975509065188488*^9}, {3.975509115528829*^9, 3.975509116484412*^9}, {
   3.975509165024123*^9, 3.9755091901310863`*^9}, {3.975510525699012*^9, 
   3.975510562349885*^9}, {3.9755106306672373`*^9, 3.9755106352549887`*^9}, {
   3.975520459224237*^9, 3.975520479166172*^9}, 3.975522931630075*^9, {
   3.9755230398569527`*^9, 3.975523118235483*^9}, {3.975523209337698*^9, 
   3.975523211158149*^9}, {3.975523385227746*^9, 3.975523386951067*^9}, {
   3.975523547995557*^9, 3.975523615955192*^9}},
 CellLabel->"In[43]:=",ExpressionUUID->"eecfa586-c6b0-4a7b-8b91-4baf20e5dec7"]
},
WindowSize->{1466, 916},
WindowMargins->{{Automatic, -605}, {Automatic, -1093}},
CellContext->Notebook,
FrontEndVersion->"14.3 for Mac OS X ARM (64-bit) (July 8, 2025)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"82f08dc7-447f-49cc-ac39-cb00cb045972"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[576, 22, 1607, 37, 131, "Input",ExpressionUUID->"4c09cc81-6789-4877-92cd-7752b83d4c52"],
Cell[2186, 61, 222, 4, 23, "Print",ExpressionUUID->"c8154190-4a69-4810-8d77-4cea139a3bcd"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2445, 70, 1722, 42, 258, "Code",ExpressionUUID->"102e89bc-f41f-4444-afd4-d1ee6d146d9b"],
Cell[4170, 114, 228, 5, 23, "Print",ExpressionUUID->"4b5f433b-1be4-4654-87ee-14a0df9716ba"],
Cell[4401, 121, 430, 11, 26, "Message",ExpressionUUID->"114c7592-974b-4781-b78f-39d6279422f6"],
Cell[CellGroupData[{
Cell[4856, 136, 209, 4, 23, "Print",ExpressionUUID->"7974124d-ea4b-416d-8c1b-706e930abfd0"],
Cell[5068, 142, 489, 12, 23, "Print",ExpressionUUID->"5b5a4130-f239-47a8-b35d-807c72621981"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[5606, 160, 7015, 171, 937, "Code",ExpressionUUID->"dff84555-3aa1-455a-8776-d2f17fc6c998"],
Cell[CellGroupData[{
Cell[12646, 335, 582, 14, 23, "Print",ExpressionUUID->"c5851644-a2cf-4710-bcc1-8c8eeb9bc8f8"],
Cell[13231, 351, 329, 8, 23, "Print",ExpressionUUID->"88b66682-69e0-42dd-8132-b9544bba5ad3"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[13609, 365, 2978, 63, 428, "Code",ExpressionUUID->"8fc9e271-e259-4c24-86ae-a87bf503f131"],
Cell[16590, 430, 430, 9, 23, "Print",ExpressionUUID->"a6dd09d4-8be2-4f02-962d-b9a086f3263b"]
}, Open  ]],
Cell[17035, 442, 1131, 17, 51, "Code",ExpressionUUID->"7dd2d715-47a8-4290-b207-cd93dbe115cb"],
Cell[18169, 461, 738, 10, 51, "Code",ExpressionUUID->"3a744eb5-64ef-40e4-9e90-04da788ac6b6"],
Cell[18910, 473, 472, 7, 51, "Code",ExpressionUUID->"a8c8a005-c579-481c-9816-2f9b576cf2f8"],
Cell[CellGroupData[{
Cell[19407, 484, 9663, 218, 1672, "Code",ExpressionUUID->"6e56728e-19b6-40d6-b515-e74a082bfe4e"],
Cell[CellGroupData[{
Cell[29095, 706, 700, 16, 23, "Print",ExpressionUUID->"82dfd602-76eb-45ba-b81f-320e746f3cd8"],
Cell[29798, 724, 700, 16, 23, "Print",ExpressionUUID->"1bdb8553-1113-4c68-915a-56db61b6ec81"],
Cell[30501, 742, 215, 4, 23, "Print",ExpressionUUID->"e1924fd6-252c-40b4-a3f7-b18bbd90264e"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[30765, 752, 8432, 201, 1502, "Code",ExpressionUUID->"fb56a14c-33f3-45a9-aebc-91093856ce26"],
Cell[CellGroupData[{
Cell[39222, 957, 710, 16, 23, "Print",ExpressionUUID->"9f289798-56fa-44d7-846f-76fca49003f1"],
Cell[39935, 975, 708, 16, 23, "Print",ExpressionUUID->"0e9e776b-faea-413a-8122-da103b895cab"],
Cell[40646, 993, 225, 4, 23, "Print",ExpressionUUID->"909621cf-de73-4d1d-ac37-17ec580c0be6"]
}, Open  ]]
}, Open  ]],
Cell[40898, 1001, 369, 6, 51, "Code",ExpressionUUID->"20649f0d-ffa0-412f-8278-368a4f8257e7"],
Cell[41270, 1009, 293, 5, 51, "Code",ExpressionUUID->"8612960f-105d-4155-9d10-6e95990fdc1b"],
Cell[41566, 1016, 415, 6, 51, "Code",ExpressionUUID->"dfd9cc79-b3db-499b-833e-be5fb4176270"],
Cell[41984, 1024, 671, 10, 51, "Code",ExpressionUUID->"ad31b1ce-13f2-4018-8baf-febb971acf60"],
Cell[42658, 1036, 7334, 167, 729, "Code",ExpressionUUID->"eecfa586-c6b0-4a7b-8b91-4baf20e5dec7"]
}
]
*)

